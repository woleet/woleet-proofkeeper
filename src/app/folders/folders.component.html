<div>
  <mat-card class="full-size-card">
    <button mat-fab color="primary" class="folder-add-button" (click)="onAddFolderClick();">
      <mat-icon [inline]="true" [style.font-size.px]="48">add</mat-icon>
    </button>
    <mat-tab-group class="action-tab" (selectedIndexChange)="onTabChange($event)">
      <mat-tab label="Anchor">
      </mat-tab>
      <mat-tab label="Signature">
      </mat-tab>
    </mat-tab-group>
    <form [formGroup]="folderFormGroup" *ngIf="addState">
      <mat-form-field class="full-width">
        <input matInput class="form-control" type="text" placeholder="Folder to scan" formControlName="path">
        <button mat-icon-button matSuffix *ngIf="folderFormGroup.get('path').value" (click)="resetPath();">
          <mat-icon>close</mat-icon>
        </button>
        <button mat-button color="primary" matSuffix (click)="onClickPopUpDirectory();">Choose folder</button>
        <mat-error *ngIf="folderFormGroup.get('path').getError('collidingPaths')">
          Folder or subfolder already present
        </mat-error>
      </mat-form-field>
      <div *ngIf="folderFormGroup.get('action').value == 'sign'">
        <mat-form-field>
          <mat-select class="custom-select" formControlName="identity" name="identity" placeholder="Identity to use">
            <mat-option *ngFor="let identityName of identityService.arrayIdentityContent" [value]="identityName.name">
              {{identityName.name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="identityService.arrayIdentityContent.length === 0">
            Please add at least one identity on the settings panel
          </mat-error>
          <mat-error *ngIf="identityService.arrayIdentityContent.length !== 0 && folderFormGroup.get('identity').getError('voidIdentity')">
            Identity required
          </mat-error>
          <mat-error *ngIf="folderFormGroup.get('identity').getError('identityNotFound')">
            Not found
          </mat-error>
        </mat-form-field>
      </div>
      <button mat-raised-button color="primary" (click)="onClickOpenedOptionFolder('addFolderState')">Options</button>
      <div *ngIf="openedOptionFolder === 'addFolderState'">
        <div>
          <mat-checkbox color="primary" name="private" formControlName="private">
            Created proofs are not available for public search
          </mat-checkbox>
        </div>
        <div>
          <mat-checkbox color="primary" name="recursive" formControlName="recursive">
            Includes files in subfolders of selected folder
          </mat-checkbox>
        </div>
        <div>
          <mat-checkbox color="primary" name="strict" formControlName="strict">
            Anchor again if files modified
          </mat-checkbox>
        </div>
        <div>
          <mat-checkbox color="primary" name="prune" formControlName="prune">
            Delete old proofs if files modified
          </mat-checkbox>
        </div>
        <div *ngIf="folderFormGroup.controls['action'].value === 'sign'">
          <mat-checkbox color="primary" name="iDServerUnsecureSSL" formControlName="iDServerUnsecureSSL">
            Do not check the SSL certificat of Woleet.ID server (only use in developpement)
          </mat-checkbox>
        </div>
      </div>
      <span class="align-end">
        <button mat-raised-button color="primary" [disabled]="folderFormGroup.invalid" (click)="onClickAdd();">
          Add folder
        </button>
        <button mat-raised-button color="warn" (click)="onCancelAddClick();">Cancel</button>
      </span>
    </form>
    <br>
    <div class="watchedFolders">
      <!-- <mat-list role="list" class="folders-list">
        <mat-list-item class="folders-item-container full-width" *ngFor="let folder of folders.folders; last as last"
          role="listitem">
          <button mat-flat-button [disableRipple]="true" color="primary" class="action-type">{{folder.action}}</button>
          <span class="mat-line folder-path">{{folder.path}}</span>
          <button mat-raised-button color="warn" class="remove-button" (click)="onClickDelete(folder);">
            <mat-icon>delete</mat-icon>
          </button>
          <mat-divider [inset]="true" *ngIf="!last"></mat-divider>
        </mat-list-item>
      </mat-list> -->
      <mat-accordion>
        <ng-container *ngFor="let folderForm of foldersFormGroup">
          <mat-expansion-panel *ngIf="folderForm.get('action').value === folderFormGroup.get('action').value">
            <mat-expansion-panel-header>
              {{folderForm.get('path').value}}
              <button mat-raised-button color="warn" class="remove-button" (click)="onClickDelete(folderForm);">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-expansion-panel-header>
            <form [formGroup]="folderForm">
              <div *ngIf="folderForm.get('action').value === 'sign'">
                <mat-form-field>
                  <mat-select class="custom-select" formControlName="identity" name="identity" placeholder="Identity to use">
                    <mat-option *ngFor="let identityName of identityService.arrayIdentityContent" [value]="identityName.name">
                      {{identityName.name}}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="identityService.arrayIdentityContent.length === 0">
                    Please add at least one identity on the settings panel
                  </mat-error>
                  <mat-error *ngIf="identityService.arrayIdentityContent.length !== 0 && folderForm.get('identity').getError('voidIdentity')">
                    Identity required
                  </mat-error>
                  <mat-error *ngIf="folderForm.get('identity').getError('identityNotFound')">
                    Not found
                  </mat-error>
                </mat-form-field>
              </div>
              <button mat-raised-button color="primary" (click)="onClickOpenedOptionFolder(folderForm.get('path').value)">Options</button>
              <div *ngIf="openedOptionFolder === folderForm.get('path').value">
                <div>
                  <mat-checkbox color="primary" name="private" formControlName="private">
                    Created proofs are not available for public search
                  </mat-checkbox>
                </div>
                <div>
                  <mat-checkbox color="primary" name="recursive" formControlName="recursive">
                    Includes files in subfolders of selected folder
                  </mat-checkbox>
                </div>
                <div>
                  <mat-checkbox color="primary" name="strict" formControlName="strict">
                    Anchor again if files modified
                  </mat-checkbox>
                </div>
                <div>
                  <mat-checkbox color="primary" name="prune" formControlName="prune">
                    Delete old proofs if files modified
                  </mat-checkbox>
                </div>
                <div *ngIf="folderForm.get('action').value === 'sign'">
                  <mat-checkbox color="primary" name="iDServerUnsecureSSL" formControlName="iDServerUnsecureSSL">
                    Do not check the SSL certificat of Woleet.ID server (only use in developpement)
                  </mat-checkbox>
                </div>
                <span class="align-end">
                    <button mat-raised-button color="primary" [disabled]="folderForm.invalid" (click)="onClickUpdateFolderOptions(folderForm);">
                      Update configuration
                    </button>
                  </span>
              </div>
            </form>
          </mat-expansion-panel>
        </ng-container>
      </mat-accordion>
    </div>
  </mat-card>
</div>