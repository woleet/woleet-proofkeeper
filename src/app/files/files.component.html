<div>
  <mat-card class="full-size-card">
    <mat-tab-group
      class="action-tab"
      (selectedIndexChange)="onTabChange($event)"
    >
      <mat-tab [label]="translations.folders.tabs.filesToTimestamp | translate">
      </mat-tab>
      <mat-tab [label]="translations.folders.tabs.filesToSeal | translate">
      </mat-tab>
    </mat-tab-group>
    <div *ngIf="!fileHash" class="default-text">
      Déposez ici les fichiers pour lesquels vous souhaitez créer une preuve
      d'horodatage. Une fois les fichiers ancrés dans la blockchain Bitcoin,
      vous pourrez télécharger les reçus de preuve à partir de votre tableau de
      bord. Ces reçus de preuve vous permettront de prouver l'existence de vos
      fichiers à la date de l'horodatage.

      <!-- Drag and drop file to hash -->

      <div
        class="dropzone"
        appDragDrop
        (fileDropped)="onFileDropped($event)"
        (startDropping)="isDroppingAFile = true"
        (stopDropping)="isDroppingAFile = false"
      >
        <input
          #fileInput
          type="file"
          (change)="onSelectedFile($event); fileInput.value = null"
          class="dropzone-file-input"
          [ngClass]="{ 'not-clickable': isHashing }"
        />
        <div *ngIf="!isHashing">
          <mat-icon class="drop-icon">note_add</mat-icon>
          <div class="drop-text">Drop here your file</div>
        </div>

        <div *ngIf="isHashing">
          <img src="assets/images/loading-woleet-api.svg" />
          <div class="hash-progress">{{ progress | percent }}</div>
          <div class="hash-text"><em>Computing fingerprint…</em></div>
          <button
            mat-raised-button
            color="warn"
            (click)="cancelFileHash()"
            class="cancel-file-hash"
          >
            {{ translations.commons.buttons.cancel | translate }}
          </button>
        </div>
      </div>
    </div>
    <form [formGroup]="fileFormGroup" *ngIf="fileHash">
      <mat-form-field *ngIf="fileFormGroup.get('action').value == 'sign'">
        <mat-label>{{
          translations.folders.identityToUse | translate
        }}</mat-label>
        <mat-select
          class="custom-select"
          formControlName="identity"
          name="identity"
        >
          <mat-option
            *ngFor="let identityName of identityService.arrayIdentityContent"
            [value]="identityName.name"
          >
            {{ identityName.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="identityService.arrayIdentityContent.length === 0">
          {{ translations.folders.errors.addAtLeastOneIdentity | translate }}
        </mat-error>
        <mat-error
          *ngIf="
            identityService.arrayIdentityContent.length !== 0 &&
            fileFormGroup.get('identity').getError('voidIdentity')
          "
        >
          {{ translations.folders.errors.identityRequired | translate }}
        </mat-error>
        <mat-error
          *ngIf="fileFormGroup.get('identity').getError('identityNotFound')"
        >
          {{ translations.folders.errors.notFound | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field class="full-width">
        <mat-label>Nom</mat-label>
        <input matInput type="text" formControlName="name" />
      </mat-form-field>

      <mat-form-field class="full-width">
        <mat-label>Tags</mat-label>
        <mat-chip-list #chipList>
          <mat-chip *ngFor="let tag of tags" (removed)="removeTag(tag)">
            {{ tag }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
          <input
            placeholder="Nouveau tag..."
            [matChipInputFor]="chipList"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            [matChipInputAddOnBlur]="addOnBlur"
            (matChipInputTokenEnd)="addTag($event)"
          />
        </mat-chip-list>
      </mat-form-field>

      <mat-form-field
        *ngIf="fileFormGroup.get('action').value == 'sign'"
        class="full-width"
      >
        <mat-label>URL d'identité</mat-label>
        <input matInput type="text" formControlName="identityURL" />
      </mat-form-field>

      <mat-form-field class="full-width">
        <mat-label>URL de callback</mat-label>
        <input matInput type="text" formControlName="callbackURL" />
      </mat-form-field>
      <div>
        <mat-checkbox color="primary" name="public" formControlName="public">
          Public
        </mat-checkbox>
      </div>
      <span class="align-end">
        <button
          mat-raised-button
          color="primary"
          class="span-folder-add-button"
          [disabled]="fileFormGroup.invalid"
          (click)="onClickTimestamp()"
        >
          {{ translations.folders.addFolder | translate }}
        </button>
        <button mat-raised-button color="warn" (click)="onCancelAddClick()">
          {{ translations.commons.buttons.cancel | translate }}
        </button>
      </span>
    </form>
  </mat-card>
</div>
